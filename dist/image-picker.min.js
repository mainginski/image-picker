// Image Picker
// by Rodrigo Vera
//
// Version 0.2.6
// Full source at https://github.com/rvera/image-picker
(function(){var t,e,i,s,n=function(t,e){return function(){return t.apply(e,arguments)}},r=[].indexOf||function(t){for(var e=0,i=this.length;i>e;e++)if(e in this&&this[e]===t)return e;return-1};jQuery.fn.extend({imagepicker:function(e){return null==e&&(e={}),this.each(function(){var i;i=jQuery(this),i.data("picker")&&i.data("picker").destroy(),i.data("picker",new t(this,s(e)));var n=0,r=s(e),l=r.time_interval;return jQuery(".image_picker_selector .img-responsive.hide").each(function(){var t=jQuery(this);setTimeout(function(){t.removeClass("hide")},l*n),n++}),null!=e.initialized?e.initialized.call(i.data("picker")):void 0})}}),s=function(t){var e={initialized:void 0,show_label:!1,changed:void 0,clicked:void 0,selected:void 0,show_numbers:!0,class_numbers:"numbers",limit:void 0,limit_reached:void 0,time_interval:0};return jQuery.extend(e,t)},i=function(t,e){return 0===jQuery(t).not(e).length&&0===jQuery(e).not(t).length},t=function(){function t(t,e){this.opts=null!=e?e:{},this.sync_picker_with_select=n(this.sync_picker_with_select,this),this.select=jQuery(t),this.multiple="multiple"===this.select.attr("multiple"),null!=this.select.data("limit")&&(this.opts.limit=parseInt(this.select.data("limit"))),this.build_and_append_picker()}return t.prototype.destroy=function(){var t,e,i,s;for(s=this.picker_options,e=0,i=s.length;i>e;e++)t=s[e],t.destroy();return this.picker.remove(),this.select.unbind("change"),this.select.removeData("picker"),this.select.show()},t.prototype.build_and_append_picker=function(){return this.select.addClass("hide"),this.select.change(function(t){return function(){return t.sync_picker_with_select()}}(this)),null!=this.picker&&this.picker.remove(),this.create_picker(),this.select.after(this.picker),this.opts.show_numbers===!0&&this.opts.limit>0&&this.show_atual_numbers(),this.sync_picker_with_select()},t.prototype.sync_picker_with_select=function(){var t,e,i,s,n;for(s=this.picker_options,n=[],e=0,i=s.length;i>e;e++)t=s[e],t.is_selected()?n.push(t.mark_as_selected()):n.push(t.unmark_as_selected());return n},t.prototype.create_picker=function(){return this.picker=jQuery("<div class='thumbnails image_picker_selector row'></div>"),this.opts.show_numbers===!0&&this.opts.limit>0&&(numbers=jQuery("<div class='"+this.opts.class_numbers+"'></div>"),this.picker.prepend(numbers)),this.picker_options=[],this.recursively_parse_option_groups(this.select,this.picker),this.picker},t.prototype.recursively_parse_option_groups=function(t,i){var s,n,r,l,o,c,h,a,u,p;for(a=t.children("optgroup"),l=0,c=a.length;c>l;l++)r=a[l],r=jQuery(r),s=jQuery("<ul></ul>"),s.append(jQuery("<li class='group_title'>"+r.attr("label")+"</li>")),i.append(jQuery("<li>").append(s)),this.recursively_parse_option_groups(r,s);for(u=function(){var i,s,r,l;for(r=t.children("option"),l=[],i=0,s=r.length;s>i;i++)n=r[i],l.push(new e(n,this,this.opts));return l}.call(this),p=[],o=0,h=u.length;h>o;o++)n=u[o],this.picker_options.push(n),n.has_image()&&p.push(i.append(n.node));return p},t.prototype.has_implicit_blanks=function(){var t;return function(){var e,i,s,n;for(s=this.picker_options,n=[],e=0,i=s.length;i>e;e++)t=s[e],t.is_blank()&&!t.has_image()&&n.push(t);return n}.call(this).length>0},t.prototype.selected_values=function(){return this.multiple?this.select.val()||[]:[this.select.val()]},t.prototype.show_atual_numbers=function(){return $("."+this.opts.class_numbers).html(this.selected_values().length+"/"+this.opts.limit)},t.prototype.toggle=function(t){var e,s,n;if(s=this.selected_values(),n=t.value().toString(),this.multiple){if(r.call(this.selected_values(),n)>=0)e=this.selected_values(),e.splice(jQuery.inArray(n,s),1),this.select.val([]),this.select.val(e);else if(null!=this.opts.limit&&this.selected_values().length+1>this.opts.limit){if(null!=this.opts.limit_reached&&this.opts.limit_reached.call(this.select),this.opts.show_numbers===!0&&this.opts.limit>0){var l=0,o=$("."+this.opts.class_numbers);o.toggleClass("text-danger");var c=setInterval(function(){o.toggleClass("text-danger"),1===++l&&window.clearInterval(c)},1e3)}}else this.select.val(this.selected_values().concat(n));this.opts.show_numbers===!0&&this.opts.limit>0&&this.show_atual_numbers()}else this.has_implicit_blanks()&&t.is_selected()?this.select.val(""):this.select.val(n);return i(s,this.selected_values())||(this.select.change(),null==this.opts.changed)?void 0:this.opts.changed.call(this.select,s,this.selected_values())},t}(),e=function(){function t(t,e,i){this.picker=e,this.opts=null!=i?i:{},this.clicked=n(this.clicked,this),this.option=jQuery(t),this.create_node()}return t.prototype.destroy=function(){return this.node.find(".thumbnail").unbind()},t.prototype.has_image=function(){return null!=this.option.data("img-src")},t.prototype.is_blank=function(){return!(null!=this.value()&&""!==this.value())},t.prototype.is_selected=function(){var t;return t=this.picker.select.val(),this.picker.multiple?jQuery.inArray(this.value(),t)>=0:this.value()===t},t.prototype.mark_as_selected=function(){return this.node.find(".thumbnail").addClass("selected")},t.prototype.unmark_as_selected=function(){return this.node.find(".thumbnail").removeClass("selected")},t.prototype.value=function(){return this.option.val()},t.prototype.clicked=function(){return this.picker.toggle(this),null!=this.opts.clicked&&this.opts.clicked.call(this.picker.select,this),null!=this.opts.selected&&this.is_selected()?this.opts.selected.call(this.picker.select,this):void 0},t.prototype.create_node=function(){var t,e;return this.node=jQuery("<div class='col-xs-12 col-sm-6 col-md-4'/>"),t=jQuery("<img class='img-responsive hide'/>"),t.attr("src",this.option.data("img-src")),e=jQuery("<div class='thumbnail'>"),e.click({option:this},function(t){return t.data.option.clicked()}),e.append(t),this.opts.show_label&&e.append(jQuery("<p/>").html(this.label())),this.node.append(e),this.node},t}()}).call(this);